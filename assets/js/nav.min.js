(function(e){"use strict";var t;e.scrollupbar=function(n,r){function i(){return o.scrollTop()<=n.offset().top}function s(){return o.scrollTop()<n.offset().top+n.outerHeight()}r=e.extend({enterViewport:e.noop,fullyEnterViewport:e.noop,exitViewport:e.noop,partiallyExitViewport:e.noop},r);var o=e(window),u=e(document),a=n.css("position")=="fixed"?0:n.offset().top,f=o.scrollTop(),l=n.position().top,c=/(iPad|iPhone|iPod)/g.test(navigator.userAgent),h;e.scrollupbar.isInViewport=s();e.scrollupbar.isFullyInViewport=i();if(!c){o.on("scroll.scrollupbar",function(){var t=o.scrollTop(),c=n.outerHeight();if(t<0||t>u.height()-o.height()){return}if(h){clearTimeout(h)}if(t<f){if(!e.scrollupbar.isInViewport&&f-c>=a){n.css("top",f-c);e.scrollupbar.isInViewport=true;r.enterViewport()}if(i()){if(t>=a){n.css({position:"fixed",top:0})}else{n.css({position:"absolute",top:l})}if(!e.scrollupbar.isFullyInViewport){e.scrollupbar.isFullyInViewport=true;r.fullyEnterViewport()}}h=setTimeout(function(){if(!i()){n.css({position:"fixed",top:n.offset().top-t});n.animate({top:0},100,function(){e.scrollupbar.isFullyInViewport=true;r.fullyEnterViewport()})}},400)}else if(t>f){if(e.scrollupbar.isFullyInViewport){n.css({position:"absolute",top:f>a?f:l});if(!i()){e.scrollupbar.isFullyInViewport=false;r.partiallyExitViewport()}}if(e.scrollupbar.isInViewport&&!s()){e.scrollupbar.isInViewport=false;r.exitViewport()}h=setTimeout(function(){if(s()&&t-c>=a){n.animate({top:t-c},100,function(){e.scrollupbar.isInViewport=false;r.exitViewport()})}},400)}f=t})}else{o.on("touchstart.scrollupbar",function(){f=o.scrollTop()});o.on("touchend.scrollupbar",function(){var t=o.scrollTop();if(t<f||t-n.outerHeight()<a){if(t<=a){n.css({position:"absolute",top:l});n.show(function(){e.scrollupbar.isInViewport=true;e.scrollupbar.isFullyInViewport=true;r.enterViewport();r.fullyEnterViewport()})}else{n.css({position:"fixed",top:0});e.scrollupbar.isInViewport=true;r.enterViewport();n.slideDown(function(){e.scrollupbar.isFullyInViewport=true;r.fullyEnterViewport()})}}else if(t>f){e.scrollupbar.isFullyInViewport=false;r.partiallyExitViewport();n.slideUp(function(){e.scrollupbar.isInViewport=false;r.exitViewport()})}f=t})}t=function(){o.off(".scrollupbar");n.css({position:"absolute",top:l})};return n};e.scrollupbar.destroy=function(){if(t){return t()}};e.fn.scrollupbar=function(t){return e.scrollupbar(this,t)}})(jQuery)